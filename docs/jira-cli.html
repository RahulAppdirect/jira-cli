<!DOCTYPE html>  <html> <head>   <title>jira-cli.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               jira-cli.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h1>Jira Command Line Client</h1>

<p>This client depends on you having a json file in your home directory
named '.jiraclirc.json' it must contain:</p>

<pre><code>{ 
    "user": "USERNAME",
    "password":"PASSWORD",
    "host":"www.jira.com",
    "port":80,
    "project": 10100
}
</code></pre>

<p>JiraCli is on <a href="https://github.com/tebriel/jira-cli">github</a></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">fs = </span><span class="nx">require</span> <span class="s">&#39;fs&#39;</span>
<span class="nv">path = </span><span class="nx">require</span> <span class="s">&#39;path&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Because colors are pretty</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">color = </span><span class="nx">require</span><span class="p">(</span><span class="s">&#39;ansi-color&#39;</span><span class="p">).</span><span class="nx">set</span>
<span class="nv">util = </span><span class="nx">require</span> <span class="s">&#39;util&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>We're using node-jira-devel, <a href="https://github.com/tebriel/node-jira">my version</a></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">JiraApi = </span><span class="nx">require</span><span class="p">(</span><span class="s">&#39;jira&#39;</span><span class="p">).</span><span class="nx">JiraApi</span>


<span class="k">class</span> <span class="nx">JiraCli</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Builds a new JiraCli with the config file</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">constructor: </span><span class="nf">(@config)-&gt;</span>
        <span class="vi">@jira = </span><span class="k">new</span> <span class="nx">JiraApi</span><span class="p">(</span><span class="s">&#39;http&#39;</span><span class="p">,</span> <span class="nx">@config</span><span class="p">.</span><span class="nx">host</span><span class="p">,</span> <span class="nx">@config</span><span class="p">.</span><span class="nx">port</span><span class="p">,</span> <span class="nx">@config</span><span class="p">.</span><span class="nx">user</span><span class="p">,</span> <span class="nx">@config</span><span class="p">.</span><span class="nx">password</span><span class="p">,</span> <span class="s">&#39;2&#39;</span><span class="p">)</span>
        <span class="vi">@response = </span><span class="kc">null</span>
        <span class="vi">@error = </span><span class="kc">null</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Because I like colors, and I don't want to format them any more than this</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">prettyPrintIssue: </span><span class="nf">(issue)-&gt;</span>
        <span class="nv">sumColor = </span><span class="s">&quot;green&quot;</span>
        <span class="nv">sumColor = </span><span class="s">&quot;red&quot;</span> <span class="k">if</span> <span class="o">+</span><span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">status</span><span class="p">.</span><span class="nx">id</span> <span class="k">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="nx">color</span><span class="p">(</span><span class="nx">issue</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span> <span class="nx">sumColor</span><span class="p">)</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="s">&quot; - &quot;</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="nx">issue</span><span class="p">.</span><span class="nx">fields</span><span class="p">.</span><span class="nx">summary</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="s">&quot;\n&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Searches Jira for the issue number requested
this can be either a key AB-123 or just the number 123456</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">getIssue: </span><span class="nf">(issueNum)-&gt;</span>
        <span class="nx">@jira</span><span class="p">.</span><span class="nx">findIssue</span> <span class="nx">issueNum</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span>
            <span class="k">if</span> <span class="nx">response</span><span class="o">?</span>
                <span class="vi">@response = </span><span class="nx">response</span>
                <span class="nx">@prettyPrintIssue</span> <span class="nx">response</span>
            <span class="k">else</span>
                <span class="vi">@error = </span><span class="nx">error</span> <span class="k">if</span> <span class="nx">error</span><span class="o">?</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">color</span><span class="p">(</span><span class="s">&quot;Error finding issue: </span><span class="si">#{</span><span class="nx">error</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h2>Do some fancy formatting on issue types</h2>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">prettyPrintIssueTypes: </span><span class="nf">(issueType)-&gt;</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="nx">color</span><span class="p">(</span><span class="nx">issueType</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="s">&quot;white+bold&quot;</span><span class="p">)</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="s">&quot; - &quot;</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="nx">issueType</span><span class="p">.</span><span class="nx">name</span>
        <span class="k">if</span> <span class="nx">issueType</span><span class="p">.</span><span class="nx">description</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="s">&quot; - &quot;</span>
            <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="nx">issueType</span><span class="p">.</span><span class="nx">description</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="s">&quot;\n&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h2>Gets a list of all the available issue types</h2>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">getIssueTypes: </span><span class="nf">(callback)-&gt;</span>
        <span class="nx">@jira</span><span class="p">.</span><span class="nx">listIssueTypes</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span>
            <span class="k">if</span> <span class="nx">response</span><span class="o">?</span>
                <span class="nx">callback</span> <span class="nx">response</span>
            <span class="k">else</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">color</span><span class="p">(</span><span class="s">&quot;Error listing issueTypes: </span><span class="si">#{</span><span class="nx">error</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span><span class="p">)</span>
                <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Takes in a summary, description, and issue type (1, 2, and 4 on my
servers) and creates a new issue, populating from your config file</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">addIssue: </span><span class="nf">(summary, description, issueType) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Bug == 1
New Feature == 2
Improvement == 4</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">newIssue =</span>
            <span class="nv">fields:</span>
                <span class="nv">project: </span><span class="p">{</span> <span class="nx">id</span><span class="o">:</span><span class="nx">@config</span><span class="p">.</span><span class="nx">project</span> <span class="p">}</span>
                <span class="nv">summary: </span><span class="nx">summary</span>
                <span class="nv">issuetype: </span><span class="p">{</span> <span class="nx">id</span><span class="o">:</span><span class="nx">issueType</span> <span class="p">}</span>
                <span class="nv">assignee: </span><span class="p">{</span> <span class="nx">name</span><span class="o">:</span><span class="nx">@config</span><span class="p">.</span><span class="nx">user</span> <span class="p">}</span>
                <span class="nv">description: </span><span class="nx">description</span>

        <span class="nx">@jira</span><span class="p">.</span><span class="nx">addNewIssue</span> <span class="nx">newIssue</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span>
            <span class="k">if</span> <span class="nx">response</span><span class="o">?</span>
                <span class="vi">@response = </span><span class="nx">response</span> <span class="k">if</span> <span class="nx">response</span><span class="o">?</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;Issue </span><span class="si">#{</span><span class="nx">response</span><span class="p">.</span><span class="nx">key</span><span class="si">}</span><span class="s"> has been </span><span class="si">#{</span><span class="nx">color</span><span class="p">(</span><span class="s">&quot;created&quot;</span><span class="p">,</span> <span class="s">&quot;green&quot;</span><span class="p">)</span><span class="si">}</span><span class="s">&quot;</span>
            <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>The error object is non-standard here from Jira, I'll parse
it better later</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="vi">@error = </span><span class="nx">error</span> <span class="k">if</span> <span class="nx">error</span><span class="o">?</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">color</span><span class="p">(</span><span class="s">&quot;Error creating issue: </span><span class="si">#{</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span><span class="p">)</span>

            <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Deletes an issue (if you have permissions) from Jira. I haven't tested
this successfully because I don't have permissions.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">deleteIssue: </span><span class="nf">(issueNum)-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Don't have permissions currently</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">@jira</span><span class="p">.</span><span class="nx">deleteIssue</span> <span class="nx">issueNum</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span>
            <span class="k">if</span> <span class="nx">response</span><span class="o">?</span>
                <span class="vi">@response = </span><span class="nx">response</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;Issue </span><span class="si">#{</span><span class="nx">issueNum</span><span class="si">}</span><span class="s"> was </span><span class="si">#{</span><span class="nx">color</span><span class="p">(</span><span class="s">&quot;deleted&quot;</span><span class="p">,</span> <span class="s">&quot;green&quot;</span><span class="p">)</span><span class="si">}</span><span class="s">&quot;</span>
            <span class="k">else</span>
                <span class="vi">@error = </span><span class="nx">error</span> <span class="k">if</span> <span class="nx">error</span><span class="o">?</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">color</span><span class="p">(</span><span class="s">&quot;Error deleting issue: </span><span class="si">#{</span><span class="nx">error</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span><span class="p">)</span>

    <span class="nv">prettyPrintTransition: </span><span class="nf">(transition) -&gt;</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="nx">color</span><span class="p">(</span><span class="nx">transition</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="s">&quot;white+bold&quot;</span><span class="p">)</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="s">&quot; - &quot;</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="nx">transition</span><span class="p">.</span><span class="nx">name</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="s">&quot;\n&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <h2>Get Transitions List for an Issue</h2>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">listTransitions: </span><span class="nf">(issueNum, callback) -&gt;</span>
        <span class="nx">@jira</span><span class="p">.</span><span class="nx">listTransitions</span> <span class="nx">issueNum</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">transitions</span><span class="p">)</span><span class="o">=&gt;</span>
            <span class="k">if</span> <span class="nx">transitions</span><span class="o">?</span>
                <span class="nx">callback</span> <span class="nx">transitions</span>
            <span class="k">else</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">color</span><span class="p">(</span><span class="s">&quot;Error getting transitions: </span><span class="si">#{</span><span class="nx">error</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span><span class="p">)</span>
                <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Resolves an issue in Jira, defaults to "Resolved", though maybe someday I
should change it to "closed" or at least give an option</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">transitionIssue: </span><span class="nf">(issueNum, transitionNum)-&gt;</span>
        <span class="nv">issueUpdate =</span>
            <span class="nv">transition:</span>
                <span class="nx">id</span><span class="o">:</span><span class="nx">transitionNum</span>
        <span class="nx">@jira</span><span class="p">.</span><span class="nx">transitionIssue</span> <span class="nx">issueNum</span><span class="p">,</span> <span class="nx">issueUpdate</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span>
            <span class="k">if</span> <span class="nx">response</span><span class="o">?</span>
                <span class="vi">@response = </span><span class="nx">response</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;Issue </span><span class="si">#{</span><span class="nx">issueNum</span><span class="si">}</span><span class="s"> was </span><span class="si">#{</span><span class="nx">color</span><span class="p">(</span><span class="s">&quot;transitioned&quot;</span><span class="p">,</span> <span class="s">&quot;green&quot;</span><span class="p">)</span><span class="si">}</span><span class="s">&quot;</span>
            <span class="k">else</span>
                <span class="vi">@error = </span><span class="nx">error</span> <span class="k">if</span> <span class="nx">error</span><span class="o">?</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">color</span><span class="p">(</span><span class="s">&quot;Error transitioning issue: </span><span class="si">#{</span><span class="nx">error</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span><span class="p">)</span>

            <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Gets a list of issues for the user listed in the config file, pretty
prints them and only shows open ones by default from the cli, probably
should add an option, though I don't know who wants to see all their
closed issues</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">getMyIssues: </span><span class="nf">(open)-&gt;</span>
        <span class="nx">@jira</span><span class="p">.</span><span class="nx">getUsersIssues</span> <span class="nx">@config</span><span class="p">.</span><span class="nx">user</span><span class="p">,</span> <span class="nx">open</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">issueList</span><span class="p">)</span> <span class="o">=&gt;</span>
            <span class="k">if</span> <span class="nx">issueList</span><span class="o">?</span>
                <span class="vi">@myIssues = </span><span class="nx">issueList</span>
                <span class="k">for</span> <span class="nx">issue</span> <span class="k">in</span> <span class="nx">issueList</span><span class="p">.</span><span class="nx">issues</span>
                    <span class="nx">@prettyPrintIssue</span> <span class="nx">issue</span>
            <span class="k">else</span>
                <span class="vi">@error = </span><span class="nx">error</span> <span class="k">if</span> <span class="nx">error</span><span class="o">?</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">color</span><span class="p">(</span><span class="s">&quot;Error retreiving issues list: </span><span class="si">#{</span><span class="nx">error</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <h2>Pretty Print Projects</h2>

<p>Prints the project list in a non-awful format</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">prettyPrintProject: </span><span class="nf">(project) -&gt;</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="nx">color</span><span class="p">(</span><span class="nx">project</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span> <span class="s">&quot;white+bold&quot;</span><span class="p">)</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="s">&quot; - &quot;</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="nx">project</span><span class="p">.</span><span class="nx">id</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="s">&quot; - &quot;</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="nx">project</span><span class="p">.</span><span class="nx">name</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span> <span class="s">&quot;\n&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h2>List all Projects</h2>

<p>This lists all the projects viewable with your account</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">getMyProjects: </span><span class="nf">(callback)-&gt;</span>
        <span class="nx">@jira</span><span class="p">.</span><span class="nx">listProjects</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">projectList</span><span class="p">)</span> <span class="o">=&gt;</span>
            <span class="k">if</span> <span class="nx">projectList</span><span class="o">?</span>
                <span class="nx">callback</span> <span class="nx">projectList</span>
            <span class="k">else</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">color</span><span class="p">(</span><span class="s">&quot;Error listing projects: </span><span class="si">#{</span><span class="nx">error</span><span class="si">}</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span><span class="p">)</span>
                <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span>


<span class="nv">module.exports = </span><span class="p">{</span>
    <span class="nx">JiraCli</span>
<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>This is great, stole it from <a href="http://st-on-it.blogspot.com/2011/05/how-to-read-user-input-with-nodejs.html">St. On It</a></p>

<p>Re-formatted it to be in coffeescript</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">ask = </span><span class="nf">(question, format, callback) -&gt;</span>
    <span class="nv">stdin = </span><span class="nx">process</span><span class="p">.</span><span class="nx">stdin</span>
    <span class="nv">stdout = </span><span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span>
 
    <span class="nx">stdin</span><span class="p">.</span><span class="nx">resume</span><span class="p">()</span>
    <span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">question</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span><span class="p">)</span>
 
    <span class="nx">stdin</span><span class="p">.</span><span class="nx">once</span> <span class="s">&#39;data&#39;</span><span class="p">,</span> <span class="nf">(data) -&gt;</span>
        <span class="nv">data = </span><span class="nx">data</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">trim</span><span class="p">()</span>
 
        <span class="k">if</span> <span class="nx">format</span><span class="p">.</span><span class="nx">test</span> <span class="nx">data</span>
            <span class="nx">callback</span> <span class="nx">data</span>
        <span class="k">else</span>
            <span class="nx">stdout</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s">&quot;It should match: &quot;</span><span class="o">+</span> <span class="nx">format</span> <span class="o">+</span><span class="s">&quot;\n&quot;</span><span class="p">)</span>
            <span class="nx">ask</span><span class="p">(</span><span class="nx">question</span><span class="p">,</span> <span class="nx">format</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span>
<span class="nv">issueSorter = </span><span class="nf">(a, b)-&gt;</span>
    <span class="nv">first = </span><span class="nb">parseInt</span> <span class="nx">a</span><span class="p">.</span><span class="nx">id</span>
    <span class="nv">second = </span><span class="nb">parseInt</span> <span class="nx">b</span><span class="p">.</span><span class="nx">id</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="nx">first</span> <span class="o">&lt;</span> <span class="nx">second</span>
    <span class="k">return</span> <span class="mi">0</span> <span class="k">if</span> <span class="nx">first</span> <span class="o">is</span> <span class="nx">second</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="nx">first</span> <span class="o">&gt;</span> <span class="nx">second</span>

<span class="k">if</span> <span class="nx">require</span><span class="p">.</span><span class="nx">main</span> <span class="o">is</span> <span class="nx">module</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Parse some options!!</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">argv = </span><span class="p">(</span><span class="nx">require</span> <span class="s">&#39;optimist&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">options</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">alias</span><span class="o">:</span><span class="s">&#39;find&#39;</span>
            <span class="nx">describe</span><span class="o">:</span><span class="s">&#39;Finds the specified Jira ID&#39;</span>
        <span class="p">}).</span><span class="nx">options</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">alias</span><span class="o">:</span><span class="s">&#39;add&#39;</span>
            <span class="nx">describe</span><span class="o">:</span><span class="s">&#39;Allows you to add a new Jira Task&#39;</span>
        <span class="p">}).</span><span class="nx">options</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">alias</span><span class="o">:</span><span class="s">&#39;transition&#39;</span>
            <span class="nx">describe</span><span class="o">:</span><span class="s">&#39;Allows you to resolve a specific Jira ID&#39;</span>
        <span class="p">}).</span><span class="nx">options</span><span class="p">(</span><span class="s">&#39;l&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">alias</span><span class="o">:</span><span class="s">&#39;list&#39;</span>
            <span class="nv">default: </span><span class="kc">false</span>
            <span class="nx">describe</span><span class="o">:</span><span class="s">&#39;Lists all your open issues&#39;</span>
        <span class="p">}).</span><span class="nx">options</span><span class="p">(</span><span class="s">&#39;p&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">alias</span><span class="o">:</span><span class="s">&#39;projects&#39;</span>
            <span class="nx">describe</span><span class="o">:</span><span class="s">&#39;Lists all your viewable projects&#39;</span>
        <span class="p">}).</span><span class="nx">options</span><span class="p">(</span><span class="s">&#39;h&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">alias</span><span class="o">:</span><span class="s">&#39;help&#39;</span>
            <span class="nx">describe</span><span class="o">:</span><span class="s">&#39;Shows this help message&#39;</span>
            <span class="nx">default</span><span class="o">:</span><span class="kc">false</span>
        <span class="p">}).</span><span class="nx">usage</span><span class="p">(</span><span class="s">&#39;Usage: jira -f EG-143 -- jira -r EG-143&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">boolean</span><span class="p">(</span><span class="s">&#39;h&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">boolean</span><span class="p">(</span><span class="s">&#39;l&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">string</span><span class="p">(</span><span class="s">&#39;f&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">string</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nx">argv</span><span class="p">.</span><span class="nx">argv</span><span class="p">.</span><span class="nx">help</span>
        <span class="nx">argv</span><span class="p">.</span><span class="nx">showHelp</span><span class="p">()</span>
        <span class="k">return</span>

    <span class="nv">args = </span><span class="nx">argv</span><span class="p">.</span><span class="nx">argv</span>
    <span class="nv">configFile = </span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">HOME</span><span class="p">,</span> <span class="s">&#39;.jiraclirc.json&#39;</span>
    <span class="nx">unless</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span> <span class="nx">configFile</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;Get your crap together and get a config file&quot;</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="nx">configFile</span>
        <span class="k">return</span>
    <span class="nv">configFile = </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span> <span class="nx">configFile</span>
    <span class="nv">configFile = </span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span> <span class="nx">configFile</span>

    <span class="nv">jiraCli = </span><span class="k">new</span> <span class="nx">JiraCli</span> <span class="nx">configFile</span>

    <span class="k">if</span> <span class="nx">args</span><span class="p">.</span><span class="nx">l</span>
        <span class="nx">jiraCli</span><span class="p">.</span><span class="nx">getMyIssues</span> <span class="kc">true</span>
        <span class="k">return</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">args</span><span class="p">.</span><span class="nx">f</span><span class="o">?</span>
        <span class="nx">jiraCli</span><span class="p">.</span><span class="nx">getIssue</span> <span class="nx">args</span><span class="p">.</span><span class="nx">f</span>
        <span class="k">return</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">args</span><span class="p">.</span><span class="nx">t</span><span class="o">?</span>
        <span class="nx">jiraCli</span><span class="p">.</span><span class="nx">listTransitions</span> <span class="nx">args</span><span class="p">.</span><span class="nx">t</span><span class="p">,</span> <span class="nf">(transitions) -&gt;</span>
            <span class="nx">transitions</span><span class="p">.</span><span class="nx">sort</span> <span class="nx">issueSorter</span>
            <span class="k">for</span> <span class="nx">transition</span> <span class="k">in</span> <span class="nx">transitions</span>
                <span class="nx">jiraCli</span><span class="p">.</span><span class="nx">prettyPrintTransition</span> <span class="nx">transition</span>
            <span class="nv">allowedTypes = </span><span class="p">(</span><span class="nx">transition</span><span class="p">.</span><span class="nx">id</span> <span class="k">for</span> <span class="nx">transition</span> <span class="k">in</span> <span class="nx">transitions</span><span class="p">)</span>
            <span class="nv">allowedTypes = </span><span class="k">new</span> <span class="nb">RegExp</span> <span class="s">&quot;[</span><span class="si">#{</span><span class="nx">allowedTypes</span><span class="p">.</span><span class="nx">join</span> <span class="s">&#39;|&#39;</span><span class="si">}</span><span class="s">]&quot;</span>
            <span class="nx">ask</span> <span class="s">&quot;Transtion Type &quot;</span><span class="p">,</span> <span class="nx">allowedTypes</span><span class="p">,</span> <span class="nf">(type)-&gt;</span>
                <span class="nx">jiraCli</span><span class="p">.</span><span class="nx">transitionIssue</span> <span class="nx">args</span><span class="p">.</span><span class="nx">t</span><span class="p">,</span> <span class="nx">type</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">args</span><span class="p">.</span><span class="nx">p</span><span class="o">?</span>
        <span class="nv">projects = </span><span class="nx">jiraCli</span><span class="p">.</span><span class="nx">getMyProjects</span> <span class="p">(</span><span class="nx">projects</span><span class="p">)</span><span class="o">=&gt;</span>
            <span class="k">for</span> <span class="nx">project</span> <span class="k">in</span> <span class="nx">projects</span>
                <span class="nx">jiraCli</span><span class="p">.</span><span class="nx">prettyPrintProject</span> <span class="nx">project</span>
        <span class="k">return</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">args</span><span class="p">.</span><span class="nx">a</span><span class="o">?</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Gather the summary, description, an type
This should poll jira to get a list of available types instead of
using my hardcoded ones</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">ask</span> <span class="s">&quot;Summary&quot;</span><span class="p">,</span> <span class="sr">/.+/</span><span class="p">,</span> <span class="nf">(summary)-&gt;</span>
            <span class="nx">ask</span> <span class="s">&quot;Description&quot;</span><span class="p">,</span> <span class="sr">/.+/</span><span class="p">,</span> <span class="nf">(description)-&gt;</span>
                <span class="nx">jiraCli</span><span class="p">.</span><span class="nx">getIssueTypes</span> <span class="nf">(issueTypes)-&gt;</span>
                    <span class="nx">issueTypes</span><span class="p">.</span><span class="nx">sort</span> <span class="nx">issueSorter</span>
                    <span class="k">for</span> <span class="nx">type</span> <span class="k">in</span> <span class="nx">issueTypes</span>
                        <span class="nx">jiraCli</span><span class="p">.</span><span class="nx">prettyPrintIssueTypes</span> <span class="nx">type</span>
                        
                    <span class="nv">allowedTypes = </span><span class="p">(</span><span class="nx">type</span><span class="p">.</span><span class="nx">id</span> <span class="k">for</span> <span class="nx">type</span> <span class="k">in</span> <span class="nx">issueTypes</span><span class="p">)</span>
                    <span class="nv">allowedTypes = </span><span class="k">new</span> <span class="nb">RegExp</span> <span class="s">&quot;[</span><span class="si">#{</span><span class="nx">allowedTypes</span><span class="p">.</span><span class="nx">join</span> <span class="s">&#39;|&#39;</span><span class="si">}</span><span class="s">]&quot;</span>
                    <span class="nx">ask</span> <span class="s">&quot;Type &quot;</span><span class="p">,</span> <span class="nx">allowedTypes</span><span class="p">,</span> <span class="nf">(type)-&gt;</span>
                        <span class="nx">jiraCli</span><span class="p">.</span><span class="nx">addIssue</span> <span class="nx">summary</span><span class="p">,</span> <span class="nx">description</span><span class="p">,</span> <span class="nx">type</span>

    <span class="k">else</span>
        <span class="nx">argv</span><span class="p">.</span><span class="nx">showHelp</span><span class="p">()</span>
        <span class="k">return</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 